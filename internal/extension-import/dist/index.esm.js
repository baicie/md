import{Extension as e}from"@tiptap/core";const t=(e,t)=>{t.blockQuote&&e.searchParams.set("blockquote",t.blockQuote),t.bold&&e.searchParams.set("bold",t.bold),t.bulletList&&e.searchParams.set("bulletlist",t.bulletList),t.code&&e.searchParams.set("code",t.code),t.codeBlock&&e.searchParams.set("codeblock",t.codeBlock),t.hardBreak&&e.searchParams.set("hardbreak",t.hardBreak),t.heading&&e.searchParams.set("heading",t.heading),t.horizontalRule&&e.searchParams.set("horizontalrule",t.horizontalRule),t.italic&&e.searchParams.set("italic",t.italic),t.link&&e.searchParams.set("link",t.link),t.listItem&&e.searchParams.set("listitem",t.listItem),t.orderedList&&e.searchParams.set("orderedlist",t.orderedList),t.paragraph&&e.searchParams.set("paragraph",t.paragraph),t.strike&&e.searchParams.set("strikethrough",t.strike),t.table&&e.searchParams.set("table",t.table),t.tableCell&&e.searchParams.set("tablecell",t.tableCell),t.tableHeader&&e.searchParams.set("tableheader",t.tableHeader),t.tableRow&&e.searchParams.set("tablerow",t.tableRow),t.underline&&e.searchParams.set("underline",t.underline)};function a({json:e,validMarks:t,validNodes:r,options:o,rewrittenContent:n=[]}){return e.marks&&Array.isArray(e.marks)&&(e.marks=e.marks.filter((a=>{const r="string"==typeof a?a:a.type;return!!t.has(r)||(n.push({original:JSON.parse(JSON.stringify(e)),unsupported:r}),!1)}))),e.content&&Array.isArray(e.content)&&(e.content=e.content.map((e=>a({json:e,validMarks:t,validNodes:r,options:o,rewrittenContent:n}).json)).filter((e=>null!=e))),e.type&&!r.has(e.type)?e.content&&Array.isArray(e.content)?(n.push({original:JSON.parse(JSON.stringify(e)),unsupported:e.type}),e.type="paragraph",{json:e,rewrittenContent:n}):{json:null,rewrittenContent:n}:{json:e,rewrittenContent:n}}function r(e,t,r){return a({json:e,validNodes:new Set(Object.keys(t.nodes)),validMarks:new Set(Object.keys(t.marks)),options:r})}const o={docx:"docx",odt:"odt",md:"md",gfm:"md"},n=e.create({name:"import",addOptions:()=>({endpoint:"https://api.tiptap.dev/v1/convert",token:"",appId:"",imageUploadCallbackUrl:void 0}),addCommands(){return{import:e=>()=>{let{file:a}=e;const{format:o,onImport:n}=e,s=new FormData;a.name.endsWith(".md")&&!a.type&&(a=new File([a],a.name,{type:"text/markdown"})),s.append("file",a),this.options.imageUploadCallbackUrl&&s.append("imageUploadCallbackUrl",this.options.imageUploadCallbackUrl);const i=new URL(`${this.options.endpoint}/import${this.options.experimentalDocxImport&&"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===a.type?"-docx":""}`);return"gfm"===o&&i.searchParams.set("gfm","1"),e.types&&t(i,e.types),fetch(i.href,{method:"POST",body:s,headers:{Authorization:`Bearer ${this.options.token}`,"X-App-Id":this.options.appId}}).then((e=>{if(!e.ok)throw new Error(e.statusText);return e.json()})).then((e=>{const t=(t=e.data.content)=>{try{const{json:e,rewrittenContent:a}=r(t,this.editor.schema);a.length&&"development"===process.env.NODE_ENV&&console.warn("Unknown content was found and replaced:",a),this.editor.commands.insertContentAt({from:0,to:this.editor.state.doc.nodeSize-2},e,{errorOnInvalidContent:!1})}catch(e){throw console.error(e),e}};return n?n({content:e.data.content,error:null,setEditorContent:t}):t()})).catch((e=>{if(!n)throw e;n({content:null,error:e})})),!0}}}});export{n as Import,t as createTypeOptionParams,n as default,o as formatMap};
